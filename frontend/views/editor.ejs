<!DOCTYPE html>
<html>
<head>
    <title>Blog Post with Image Upload</title>
    <script src="https://cdn.jsdelivr.net/npm/quill@2.0.2/dist/quill.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/quill@2.0.2/dist/quill.snow.css" rel="stylesheet">
    <style>
        #editor-container {
            height: 200px;
        }
    </style>
</head>
<body>
    <h1>Post a Blog</h1>
    <form id="editor-form" action="/submit" method="post">
        <div id="editor-container"></div>
        <br>
        <input type="text" name="title" placeholder="Title" required>
        <input type="hidden" id="editor-content" name="content">

        <br>
        <button type="submit">Submit</button>
    </form>

    <script src="quill/quill.min.js"></script>
    <script>
        var quill = new Quill('#editor-container', {
            modules: {
                toolbar: {
                    container: [
                        [{ 'header': [1, 2, false] }],
                        ['bold', 'italic', 'underline'],
                        ['image', 'code-block']
                    ],
                    handlers: {
                        image: imageHandler
                    }
                }
            },
            placeholder: 'Compose an epic...',
            theme: 'snow'
        });

        function imageHandler() {
            var input = document.createElement('input');
            input.setAttribute('type', 'file');
            input.setAttribute('accept', 'image/*');
            input.click();

            input.onchange = function() {
                var file = input.files[0];
                if (file) {
                    var formData = new FormData();
                    formData.append('image', file);

                    fetch('/upload', {
                        method: 'POST',
                        body: formData
                    })
                    .then(response => response.json())
                    .then(data => {
                        var range = quill.getSelection();
                        quill.insertEmbed(range.index, 'image', data.url);
                    })
                    .catch(error => {
                        console.error('Error:', error);
                    });
                }
            };
        }

        document.getElementById('editor-form').onsubmit = function() {
            var content = document.querySelector('input[name=content]');
            content.value = quill.root.innerHTML;
        };
    </script>
</body>
</html>
